<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Fiction - Game</title>
    <link rel="stylesheet" href="./css/game.css">
</head>

<body>
    <div class="game-container">
        <!-- 移动端遮罩层 -->
        <div class="overlay" id="overlay"></div>
        
        <div class="game-header">
            <!-- 移动端菜单按钮 -->
            <button class="menu-toggle" id="menuToggle">☰</button>
            <div class="game-title">🎮 互动小说游戏</div>
            <button class="back-btn" onclick="window.location.href='index.html'">← 返回上传页面</button>
            <button class="back-btn-sm" onclick="window.location.href='index.html'">返回</button>
        </div>

        <!-- 状态面板 -->
        <div class="status-panel" id="statusPanel">
            <!-- 连接状态 -->
            <div class="status-section">
                <h3>🔗 连接状态</h3>
                <div class="connection-status">
                    <span id="statusIndicator">⚫</span>
                    <span id="statusText">未连接</span>
                </div>
            </div>

            <div class="status-section">
                <h3>📊 角色信息</h3>
                <div class="status-item">
                    <span class="status-label">姓名:</span>
                    <span class="status-value" id="charName">玩家</span>
                </div>
                <div class="status-item">
                    <span class="status-label">等级:</span>
                    <span class="status-value" id="charLevel">1</span>
                </div>
                <div class="status-item">
                    <span class="status-label">生命值:</span>
                    <span class="status-value" id="charHealth">100/100</span>
                </div>
                <div class="health-bar">
                    <div class="health-fill" id="healthFill" style="width: 100%"></div>
                </div>
                <div class="status-item">
                    <span class="status-label">能量:</span>
                    <span class="status-value" id="charEnergy">100/100</span>
                </div>
                <div class="energy-bar">
                    <div class="energy-fill" id="energyFill" style="width: 100%"></div>
                </div>
                <div class="status-item">
                    <span class="status-label">金钱:</span>
                    <span class="status-value" id="charMoney">0</span>
                </div>
            </div>

            <div class="status-section">
                <h3>⚡ 属性</h3>
                <div class="attribute-grid" id="attributeGrid">
                    <!-- 属性将从PDF动态加载 -->
                    <p style="color: #999; font-size: 0.85em; text-align: center;">加载中...</p>
                </div>
            </div>

            <div class="status-section">
                <h3>🎒 背包 (<span id="inventoryCount">0</span>)</h3>
                <div id="inventoryList">
                    <p style="color: #999; font-size: 0.85em; text-align: center;">空的</p>
                </div>
            </div>

            <div class="status-section">
                <h3>📍 当前位置</h3>
                <div style="color: #333; font-weight: 600;" id="charLocation">起始点</div>
            </div>
        </div>

        <div class="chat-area" id="chatArea">
            <div class="hint">
                欢迎！输入 <strong>"开始游戏"</strong> 或 <strong>"start game"</strong> 开始你的冒险。
            </div>
        </div>

        <div class="input-area">
            <button class="start-game-btn" id="startGameBtn" onclick="startGameWithButton()">🎮 开始游戏</button>
            <div class="input-row">
                <input type="text" class="input-field" id="playerInput" placeholder="在这里输入你的行动..."
                    onkeypress="handleKeyPress(event)" />
                <button class="send-btn" id="sendBtn" onclick="sendAction()">发送</button>
            </div>
        </div>
    </div>

    <!-- Markdown渲染库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script src="game.js"></script>
    <script>
        // 侧边栏控制函数
        function toggleSidebar() {
            const sidebar = document.getElementById('statusPanel');
            const overlay = document.getElementById('overlay');
            const menuToggle = document.getElementById('menuToggle');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // 更新菜单图标
            if (sidebar.classList.contains('active')) {
                menuToggle.textContent = '✕';
            } else {
                menuToggle.textContent = '☰';
            }
        }

        // 初始化事件监听
        document.addEventListener('DOMContentLoaded', function() {
            // 点击遮罩层关闭侧边栏
            document.getElementById('overlay').addEventListener('click', function() {
                toggleSidebar();
            });

            // 点击菜单按钮切换侧边栏
            document.getElementById('menuToggle').addEventListener('click', function(e) {
                e.stopPropagation();
                toggleSidebar();
            });
        });

    </script>
</body>

</html>